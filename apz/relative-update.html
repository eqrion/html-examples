<!DOCTYPE>
<html>
<head>
<style type="text/css">
    #container {
        overflow: scroll;
        width: 400px;
        height: 600px;
        border: 0.5em solid;
    }
    pre {
        margin: 0px;
        font-size: 1.5em;
    }
    .even {
        background-color: gray;
        text-align: left;
    }
    .odd {
        background-color: lightgray;
        text-align: right;
    }
</style>
</head>
<body>
    <div id="container">
    </div>
    <script type="text/javascript">
        let container = document.querySelector('#container');
        let rowIndex = 0;
        let lastGroup = null;
        let lastRow = null;
        let intervalID = null;

        function busyWait() {
            let until = performance.now() + 1000;
            while (performance.now() < until) { }
        }

        function insertGroup() {
            let group = document.createElement('div');
            lastRow = null;

            for (let i = 0; i < 10; i += 1) {
                let row = document.createElement('pre');
                row.textContent = '' + rowIndex;

                if (i % 2 == 0) {
                    row.className = 'even';
                } else {
                    row.className = 'odd';
                }

                group.insertBefore(row, lastRow);
                lastRow = row;

                rowIndex += 1;
            }

            container.insertBefore(group, lastGroup);
            lastGroup = group;

            let scrollHeight = group.clientHeight;
            container.scrollBy(0, scrollHeight);
        }

        function asyncInsert() {
            insertGroup();
            if (rowIndex > 1000) {
                clearInterval(intervalID);
            }
        }

        setInterval(busyWait, 1000);
        intervalID = setInterval(asyncInsert, 1000);
    </script>
</body>
</html>
